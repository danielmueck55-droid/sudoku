<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Sudoku ‚Äì Weihnachten</title>

  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

  <style>

    /* -------------------------
       GLOBAL SCALE VARIABLES
    -------------------------- */
    :root {
      --scale: 1;
      --frame-base: 430px;
      --cell-base: 40px;
      --border-base: 3px;
      --font-base: 20px;
      --btn-font-base: 17px;
    }

    @media (max-width: 480px) {
      :root { --scale: 0.88; }
    }

    @media (max-width: 380px) {
      :root { --scale: 0.75; }
    }

    /* -------------------------
       BASIC PAGE STYLE
    -------------------------- */
    body {
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding-top: 20px;
      background: linear-gradient(#f8f8f8, #d8e3f0);
      background-image:
        url('data:image/svg+xml,%3Csvg width="100" height="100" xmlns="http://www.w3.org/2000/svg"%3E%3Ctext x="10" y="55" font-size="20" fill="%23e0e0e0"%3E‚úª%3C/text%3E%3C/svg%3E'),
        url('data:image/svg+xml,%3Csvg width="120" height="120" xmlns="http://www.w3.org/2000/svg"%3E%3Ctext x="15" y="65" font-size="22" fill="%23f2d4d4"%3E‚ú¶%3C/text%3E%3C/svg%3E');
      background-repeat: repeat;
      overflow-x: hidden;
    }

    h1, h2 {
      font-family: 'Great Vibes', cursive;
      color: #b30000;
      text-shadow: 0 0 4px rgba(255,255,255,0.7);
      margin: 0;
    }

    h1 { font-size: 3rem; }
    h2 { font-size: 2rem; }

    /* -------------------------
       FRAME (RED BORDER BOX)
    -------------------------- */
    #frame {
      width: min(var(--frame-base), 92vw);
      transform: scale(var(--scale));
      transform-origin: top center;

      border: calc(8px * var(--scale)) solid #b30000;
      border-radius: calc(20px * var(--scale));

      background: rgba(255,255,255,0.65);
      padding: calc(15px * var(--scale));
      box-shadow: 0 0 calc(15px * var(--scale)) rgba(0,0,0,0.2);
      box-sizing: border-box;

      margin-top: 25px;
    }

    /* -------------------------
       SUDOKU GRID
    -------------------------- */
    #sudoku {
      --cell-size: calc(var(--cell-base) * var(--scale));
      --border-thick: calc(var(--border-base) * var(--scale));

      display: grid;
      grid-template-columns: repeat(9, var(--cell-size));
      grid-template-rows: repeat(9, var(--cell-size));
      gap: 0 !important; /* CELLS TOUCH */
      margin: 0 auto;
    }

    .cell {
      width: var(--cell-size);
      height: var(--cell-size);

      background: white;
      border: 1px solid #ddd;
      text-align: center;
      font-size: calc(var(--font-base) * var(--scale));
      border-radius: 4px !important;  /* REDUCED ROUNDING */
      box-sizing: border-box;

      caret-color: transparent;
      cursor: pointer;
      user-select: none;
      readonly: readonly; /* DISABLE KEYBOARD */
    }

    .cell:focus {
      outline: 2px solid #b30000;
      background: #fff5f5;
    }

    /* thick block borders */
    .block-left  { border-left: var(--border-thick) solid #b30000 !important; }
    .block-right { border-right: var(--border-thick) solid #b30000 !important; }
    .block-top   { border-top: var(--border-thick) solid #b30000 !important; }
    .block-bottom{ border-bottom: var(--border-thick) solid #b30000 !important; }

    /* -------------------------
       FIXED CELLS (GIVEN NUMBERS)
    -------------------------- */
    .fixed {
      background: #f7eaea !important;
      font-weight: normal !important; /* REMOVE BOLD */
    }

    /* DARKER FOR MOBILE */
    @media (max-width: 600px) {
      .fixed {
        background: #e9c8c8 !important;
        font-weight: normal !important;
      }
      .cell {
        color: #222 !important;
      }
    }

    /* -------------------------
       NUMBER PAD
    -------------------------- */
    #numberPad {
      margin-top: 15px;
      display: grid;
      grid-template-columns: repeat(5, calc(var(--cell-base) * var(--scale)));
      grid-auto-rows: calc(var(--cell-base) * var(--scale));
      justify-content: center;
      gap: 8px;
    }

    .numBtn {
      width: calc(var(--cell-base) * var(--scale));
      height: calc(var(--cell-base) * var(--scale));
      border-radius: 8px;
      border: none;
      background: #fff;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      font-size: calc(var(--font-base) * var(--scale));
      cursor: pointer;
      box-sizing: border-box;
    }

    /* -------------------------
       CONTROLS
    -------------------------- */
    #notesToggle {
      margin-top: 12px;
      font-size: 16px;
      cursor: pointer;
    }

    .note {
      font-size: 12px;
      color: #555;
    }

    #mistakeBtn {
      margin-top: 18px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background: #b30000;
      color: white;
      cursor: pointer;
      font-size: calc(var(--btn-font-base) * var(--scale));
    }

    /* -------------------------
       WIN MESSAGE
    -------------------------- */
    #winMessage {
      margin-top: 18px;
      background: rgba(255,255,255,0.94);
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 17px;
      box-shadow: 0 0 12px rgba(0,0,0,0.25);
      opacity: 0;
      display: none;
      text-align: center;
      max-width: 92vw;
      transform: translateY(18px);
      transition: all 0.8s ease;
    }

    #winMessage h2 {
      font-family: 'Great Vibes', cursive;
      font-size: 2.3rem;
      margin: 0;
      background: linear-gradient(45deg, #b30000, #d4af37, #008000);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 0 7px rgba(255,255,255,0.7);
    }

  </style>
</head>

<body>

<h1>Felice Adventskalender</h1>
<h2>T√ºrchen 2 üéÑüéÅ</h2>

<div id="frame">
  <div id="sudoku"></div>

  <div id="notesToggle">
    <label><input type="checkbox" id="notesMode"> Notizen-Modus</label>
  </div>

  <div id="numberPad"></div>

  <button id="mistakeBtn">Fehler hervorheben</button>
</div>

<div id="winMessage">
  <h2>Geschafft!</h2>
  <p>Sei gespannt auf das n√§chste T√ºrchen! üéÑ‚ú®</p>
</div>

<script>

/* Disable mobile keyboard */
function preventKeyboard(el) {
  el.setAttribute("readonly", "readonly");
}

const puzzle = [
  [5,3,0,0,7,0,0,0,0],
  [6,0,0,1,9,5,0,0,0],
  [0,9,8,0,0,0,0,6,0],
  [8,0,0,0,6,0,0,0,3],
  [4,0,0,8,0,3,0,0,1],
  [7,0,0,0,2,0,0,0,6],
  [0,6,0,0,0,0,2,8,0],
  [0,0,0,4,1,9,0,0,5],
  [0,0,0,0,8,0,0,7,9],
];

const solution = [
  [5,3,4,6,7,8,9,1,2],
  [6,7,2,1,9,5,3,4,8],
  [1,9,8,3,4,2,5,6,7],
  [8,5,9,7,6,1,4,2,3],
  [4,2,6,8,5,3,7,9,1],
  [7,1,3,9,2,4,8,5,6],
  [9,6,1,5,3,7,2,8,4],
  [2,8,7,4,1,9,6,3,5],
  [3,4,5,2,8,6,1,7,9],
];

const sudoku = document.getElementById("sudoku");
let selectedCell = null;

function renderSudoku() {
  sudoku.innerHTML = "";

  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {

      const inp = document.createElement("input");
      inp.classList.add("cell");
      preventKeyboard(inp);

      inp.dataset.row = r;
      inp.dataset.col = c;

      if (c % 3 === 0) inp.classList.add("block-left");
      if (c === 8)     inp.classList.add("block-right");
      if (r % 3 === 0) inp.classList.add("block-top");
      if (r === 8)     inp.classList.add("block-bottom");

      if (puzzle[r][c] !== 0) {
        inp.value = puzzle[r][c];
        inp.classList.add("fixed");
        inp.disabled = true;
      }

      inp.addEventListener("click", () => {
        if (inp.classList.contains("fixed")) return;
        if (selectedCell) selectedCell.style.outline = "none";
        selectedCell = inp;
        inp.style.outline = "2px solid #b30000";
      });

      sudoku.appendChild(inp);
    }
  }
}
renderSudoku();

/* Number pad */
const numberPad = document.getElementById("numberPad");

for (let n = 1; n <= 9; n++) {
  const btn = document.createElement("button");
  btn.className = "numBtn";
  btn.textContent = n;
  btn.onclick = () => handleInput(n);
  numberPad.appendChild(btn);
}

const del = document.createElement("button");
del.className = "numBtn";
del.textContent = "‚å´";
del.onclick = () => handleInput(0);
numberPad.appendChild(del);

const notesMode = document.getElementById("notesMode");

function handleInput(value) {
  if (!selectedCell || selectedCell.classList.contains("fixed")) return;

  if (notesMode.checked) {
    if (!selectedCell.notes) selectedCell.notes = new Set();
    if (value === 0) selectedCell.notes.clear();
    else {
      if (selectedCell.notes.has(value)) selectedCell.notes.delete(value);
      else selectedCell.notes.add(value);
    }
    selectedCell.classList.add("note");
    selectedCell.value = [...selectedCell.notes].sort().join(" ");
  } else {
    selectedCell.classList.remove("note");
    selectedCell.notes = null;
    selectedCell.value = value === 0 ? "" : value;
    selectedCell.style.color = "black";
  }

  checkWin();
}

/* Press & hold mistakes */
const mistakeBtn = document.getElementById("mistakeBtn");

function showMistakes() {
  const cells = document.querySelectorAll(".cell");
  cells.forEach((cell, i) => {
    if (cell.classList.contains("fixed") || cell.classList.contains("note")) return;
    const r = Math.floor(i / 9);
    const c = i % 9;
    if (cell.value && Number(cell.value) !== solution[r][c]) {
      cell.style.color = "red";
    }
  });
}

function clearMistakes() {
  const cells = document.querySelectorAll(".cell");
  cells.forEach(cell => {
    if (!cell.classList.contains("fixed") && !cell.classList.contains("note"))
      cell.style.color = "black";
  });
}

mistakeBtn.addEventListener("mousedown", showMistakes);
mistakeBtn.addEventListener("mouseup", clearMistakes);
mistakeBtn.addEventListener("mouseleave", clearMistakes);
mistakeBtn.addEventListener("touchstart", e => { e.preventDefault(); showMistakes(); });
mistakeBtn.addEventListener("touchend", clearMistakes);
mistakeBtn.addEventListener("touchcancel", clearMistakes);

/* Win detection */
function checkWin() {
  const cells = document.querySelectorAll(".cell");

  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {
      const val = cells[r*9 + c].value;
      if (Number(val) !== solution[r][c]) return;
    }
  }
  onWin();
}

function onWin() {
  const msg = document.getElementById("winMessage");
  msg.style.display = "block";
  setTimeout(() => {
    msg.style.opacity = "1";
    msg.style.transform = "translateY(0)";
  }, 20);
}

</script>

</body>
</html>
